@{
    ViewData["Title"] = "Chat";
}

<style>
    html, body {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
    }

    .chat-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
    }

    .messages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column-reverse;
    }

    .message {
        margin: 5px 10px;
        padding: 10px 15px;
        border-radius: 20px;
        max-width: 60%;
        word-wrap: break-word;
        color: #fff;
    }

    .message.user {
        align-self: flex-end;
    }

    .message.positive { background-color: #4CAF50; }
    .message.neutral  { background-color: #9E9E9E; }
    .message.negative { background-color: #F44336; }

    .input-area {
        display: flex;
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    .input-area input[type=text] {
        flex: 1;
        padding: 10px 15px;
        border-radius: 25px;
        border: 1px solid #ccc;
        outline: none;
        margin-right: 10px;
    }

    .input-area button {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        background-color: #2196F3;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
    }

    .input-area button:hover {
        background-color: #1976D2;
    }

    .messages::-webkit-scrollbar {
        width: 8px;
    }

    .messages::-webkit-scrollbar-thumb {
        background-color: rgba(0,0,0,0.2);
        border-radius: 4px;
    }
</style>

<div class="chat-container">
    <div id="messagesList" class="messages"></div>
    <div class="input-area">
        <input id="userInput" placeholder="Your name" />
        <input id="messageInput" placeholder="Type a message..." />
        <button id="sendBtn">Send</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chatHub")
        .build();

    connection.on("ReceiveMessage", (user, message, sentiment) => {
        const li = document.createElement("div");
        li.classList.add("message");

        if(sentiment === "Positive") li.classList.add("positive");
        else if(sentiment === "Negative") li.classList.add("negative");
        else li.classList.add("neutral");

        const currentUser = document.getElementById("userInput").value;
        if(user === currentUser) li.classList.add("user");

        li.textContent = `${user}: ${message}`;
        document.getElementById("messagesList").prepend(li);
    });

    connection.start().catch(err => console.error(err.toString()));

    document.getElementById("sendBtn").addEventListener("click", () => {
    const user = document.getElementById("userInput").value;
    const msg = document.getElementById("messageInput").value;
    if(!msg) return;

    connection.invoke("SendMessage", user, msg)
        .catch(err => console.error(err.toString()));

    document.getElementById("messageInput").value = "";
});

    document.getElementById("messageInput").addEventListener("keyup", function(e){
        if(e.key === "Enter") document.getElementById("sendBtn").click();
    });
</script>
