@{
    ViewData["Title"] = "Chat";
}
<!-- STYLES -->
<style>
    html, body {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
    }

    .chat-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
    }

    .messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .message {
        margin: 5px 10px;
        padding: 10px 15px;
        border-radius: 20px;
        max-width: 70%;
        word-wrap: break-word;
        color: #fff;
        font-size: 16px;
    }

    .message.user {
        align-self: flex-end;
    }

    .message.positive { background-color: #4CAF50; }
    .message.neutral  { background-color: #FFC107; }
    .message.negative { background-color: #F44336; }

    .input-area {
        display: flex;
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ccc;
    }

    .input-area input[type=text] {
        flex: 1;
        padding: 10px 15px;
        border-radius: 25px;
        border: 1px solid #ccc;
        outline: none;
        margin-right: 10px;
    }

    .input-area button {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        background-color: #2196F3;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
    }

    .input-area button:hover {
        background-color: #1976D2;
    }
</style>

<!-- HTML STRUCTURE -->

<div class="chat-container">
    <div id="messagesList" class="messages"></div>
    <div class="input-area">
        <input id="userInput" placeholder="Your name" />
        <input id="messageInput" placeholder="Type a message..." />
        <button id="sendBtn">Send</button>
    </div>
</div>

<!-- SCRIPTS -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>

<script>
    // Create SignalR connection to server hub.
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chatHub")
        .build();
    // Receive message from server.
    connection.on("ReceiveMessage", (user, message, sentiment) => {
    const div = document.createElement("div");
    div.classList.add("message");

    // convert sentiment to number
    const s = Number(sentiment);

    // map to CSS class
    let cls = "neutral";
    if (s === 2) cls = "positive";
    else if (s === 0) cls = "negative";

    div.classList.add(cls);

    const currentUser = document.getElementById("userInput").value;
    if (user === currentUser) div.classList.add("user");

    div.textContent = `${user}: ${message}`;

    // append and autoscroll
    const msgList = document.getElementById("messagesList");
    msgList.appendChild(div);
    msgList.scrollTop = msgList.scrollHeight;
});
    // Start the SignalR connection and log errors to console.
    connection.start().catch(err => console.error(err.toString()));

    // Click handler for send button.
    // Reads user and message values, validates non-empty message,
    // invokes server method 'SendMessage' and clears input.
    document.getElementById("sendBtn").addEventListener("click", () => {
        const user = document.getElementById("userInput").value;
        const msg = document.getElementById("messageInput").value;
        if (!msg) return;

        // invoke ChatHub.SendMessage(user, msg)
        connection.invoke("SendMessage", user, msg)
            .catch(err => console.error(err.toString()));
        // clear input after sending
        document.getElementById("messageInput").value = "";
    });

    // Triggers send button click when Enter is pressed.
    document.getElementById("messageInput").addEventListener("keyup", function (e) {
        if (e.key === "Enter") document.getElementById("sendBtn").click();
    });
</script>
